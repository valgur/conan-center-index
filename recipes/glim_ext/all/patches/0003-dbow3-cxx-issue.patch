From 86ea6371ff359376a0cd84012b27453937189a1b Mon Sep 17 00:00:00 2001
From: Martin Valgur <martin.valgur@gmail.com>
Date: Fri, 19 Jul 2024 17:57:17 +0300
Subject: [PATCH] fix dbow3

---
 .../dbow_loop_detector/thirdparty/DBoW3/src/BowVector.h     | 3 +++
 .../dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.cpp  | 6 +++---
 .../dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.h    | 6 +++---
 .../dbow_loop_detector/thirdparty/DBoW3/tests/test_fbow.cpp | 2 +-
 4 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/BowVector.h b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/BowVector.h
index d8c17e0..d4cafb2 100644
--- a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/BowVector.h
+++ b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/BowVector.h
@@ -12,6 +12,9 @@
 
 #include <map>
 #include <vector>
+#include <ostream>
+#include <string>
+#include <cstdint>
 #include "exports.h"
 #if _WIN32
 #include <cstdint>
diff --git a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.cpp b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.cpp
index 9f0eff3..7df546b 100644
--- a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.cpp
+++ b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.cpp
@@ -1177,7 +1177,7 @@ void Vocabulary::save(cv::FileStorage &f,
 
 }
 
-void Vocabulary::toStream(  std::ostream &out_str, bool compressed) const throw(std::exception){
+void Vocabulary::toStream(  std::ostream &out_str, bool compressed) const {
 
     uint64_t sig=88877711233;//magic number describing the file
     out_str.write((char*)&sig,sizeof(sig));
@@ -1257,7 +1257,7 @@ void Vocabulary::toStream(  std::ostream &out_str, bool compressed) const throw(
 }
 
 
-void Vocabulary:: load_fromtxt(const std::string &filename)throw(std::runtime_error){
+void Vocabulary:: load_fromtxt(const std::string &filename) {
 
     std::ifstream ifile(filename);
     if(!ifile)throw std::runtime_error("Vocabulary:: load_fromtxt  Could not open file for reading:"+filename);
@@ -1332,7 +1332,7 @@ void Vocabulary:: load_fromtxt(const std::string &filename)throw(std::runtime_er
            }
        }
 }
-void Vocabulary::fromStream(  std::istream &str )   throw(std::exception){
+void Vocabulary::fromStream(  std::istream &str ) {
 
 
     m_words.clear();
diff --git a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.h b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.h
index 7cf5f5a..c5113b6 100644
--- a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.h
+++ b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/src/Vocabulary.h
@@ -299,8 +299,8 @@ public:
    */
   int getDescritorType()const;
   //io to-from a stream
-  void toStream(  std::ostream &str, bool compressed=true) const throw(std::exception);
-  void fromStream(  std::istream &str )   throw(std::exception);
+  void toStream(  std::ostream &str, bool compressed=true) const;
+  void fromStream(  std::istream &str );
 
  protected:
 
@@ -435,7 +435,7 @@ protected:
 
    /**Loads from ORBSLAM txt files
     */
-   void load_fromtxt(const std::string &filename)throw(std::runtime_error);
+   void load_fromtxt(const std::string &filename);
 
 protected:
 
diff --git a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/tests/test_fbow.cpp b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/tests/test_fbow.cpp
index f2f117c..aa0b377 100644
--- a/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/tests/test_fbow.cpp
+++ b/modules/mapping/dbow_loop_detector/thirdparty/DBoW3/tests/test_fbow.cpp
@@ -303,7 +303,7 @@ public:
     char *_data=0;
     string _desc_name;
 
-    void saveToFile(const std::string &filepath)throw(std::exception){
+    void saveToFile(const std::string &filepath) {
         std::ofstream str(filepath);
         if (!str) throw std::runtime_error("Vocabulary::saveToFile could not open:"+filepath);
         //magic number
-- 
2.25.1

